# 儲值介面更新說明

## 更新日期
2025年1月

## 版本
v2.1 - 儲值介面優化版

---

## 主要變更

### 🎯 移除固定儲值方案

#### 之前
使用固定的儲值方案選擇：
- 儲值 2萬（送 NT$ 2,000 = 實得 NT$ 22,000）
- 儲值 3萬（送 NT$ 3,000 = 實得 NT$ 33,000）
- 儲值 5萬（送 NT$ 5,000 = 實得 NT$ 55,000）

#### 現在
使用靈活的增減按鈕系統：
- ✅ **儲值金額**：使用 +/- 按鈕，以**千元為單位**調整
- ✅ **贈送紅利**：獨立調整，以千元為單位
- ✅ **快速選項**：提供 5K、10K、20K、50K 快速按鈕
- ✅ **紅利比例**：提供無贈送、10%、15% 快速按鈕

---

## 新介面功能

### 1. 儲值金額控制

```
┌─────────────────────────────────┐
│  儲值金額（以千元為單位）        │
├─────────────────────────────────┤
│  [-]  NT$ 10,000  [+]           │
│       實付金額                  │
├─────────────────────────────────┤
│ [5K] [10K] [20K] [50K]          │
│    快速選擇按鈕                 │
└─────────────────────────────────┘
```

**功能**：
- 點擊 `-` 按鈕：減少 NT$ 1,000（最低 NT$ 1,000）
- 點擊 `+` 按鈕：增加 NT$ 1,000（無上限）
- 點擊快速按鈕：直接設定為該金額

### 2. 贈送紅利控制

```
┌─────────────────────────────────┐
│  贈送紅利（可選）                │
├─────────────────────────────────┤
│  [-]  + NT$ 1,000  [+]          │
│        贈送金額                  │
├─────────────────────────────────┤
│ [無贈送] [10%] [15%]             │
│    快速比例按鈕                 │
└─────────────────────────────────┘
```

**功能**：
- 點擊 `-` 按鈕：減少 NT$ 1,000（最低 NT$ 0）
- 點擊 `+` 按鈕：增加 NT$ 1,000（無上限）
- 點擊 `無贈送`：設定為 0
- 點擊 `10%`：自動計算儲值金額的 10%
- 點擊 `15%`：自動計算儲值金額的 15%

### 3. 總金額顯示

```
┌─────────────────────────────────┐
│  總儲值金額：NT$ 11,000         │
│  = 實付 NT$ 10,000 + 贈送 NT$ 1,000│
└─────────────────────────────────┘
```

**自動計算**：
- 即時顯示總儲值金額
- 清楚標示實付金額與贈送金額

---

## 使用範例

### 範例 1：儲值 10,000，贈送 10%

1. 調整儲值金額為 NT$ 10,000
2. 點擊紅利 `10%` 按鈕
3. 系統自動計算贈送 NT$ 1,000
4. 總儲值金額：NT$ 11,000

### 範例 2：儲值 25,000，贈送 3,000

1. 點擊快速按鈕 `20K`（NT$ 20,000）
2. 點擊 `+` 按鈕 5 次（每次增加 NT$ 1,000）
3. 儲值金額為 NT$ 25,000
4. 手動調整贈送金額為 NT$ 3,000
5. 總儲值金額：NT$ 28,000

### 範例 3：儲值 50,000，贈送 15%

1. 點擊快速按鈕 `50K`
2. 點擊紅利 `15%` 按鈕
3. 系統自動計算贈送 NT$ 7,500
4. 總儲值金額：NT$ 57,500

---

## 優勢

### 對客戶
- ✅ **更靈活**：可以選擇任意千元整數金額
- ✅ **更透明**：清楚看到實付和贈送的分別
- ✅ **更貼心**：可以根據實際需求調整金額

### 對店家
- ✅ **更彈性**：可以自由設定贈送比例
- ✅ **更簡單**：不受固定方案限制
- ✅ **更直觀**：增減按鈕操作簡單明瞭
- ✅ **更專業**：介面更現代化

---

## 技術實現

### State 變更

```javascript
// 之前
const [depositType, setDepositType] = useState('');  // '20k', '30k', '50k'

// 現在
const [depositAmount, setDepositAmount] = useState(1000);  // 數字金額
const [bonusAmount, setBonusAmount] = useState(0);         // 贈送金額
```

### API 呼叫變更

```javascript
// 之前
await addDeposit(customerId, amount, paymentMethod, operator);

// 現在
await addDeposit(
  customerId,
  depositAmount,     // 實付金額
  bonusAmount,       // 贈送金額
  paymentMethod,
  operator,
  notes
);
```

### 儲值記錄結構

```javascript
{
  depositAmount: 10000,     // 實付金額
  bonusAmount: 1000,        // 贈送金額
  totalAmount: 11000,       // 總儲值額
  receiptNumber: "DEP12345678",
  paymentMethod: "cash",
  operator: "系統管理員"
}
```

---

## 操作指南

### 管理員操作流程

1. **開啟儲值對話框**
   - 在客戶管理頁面
   - 點擊客戶的「儲值」按鈕

2. **設定儲值金額**
   - 使用 +/- 按鈕調整（千元為單位）
   - 或點擊快速按鈕（5K/10K/20K/50K）
   - 最低金額：NT$ 1,000

3. **設定贈送紅利**（可選）
   - 使用 +/- 按鈕手動調整
   - 或點擊 `無贈送`（0元）
   - 或點擊 `10%`、`15%` 自動計算

4. **確認總金額**
   - 檢查總儲值金額顯示
   - 確認實付與贈送分項正確

5. **選擇付款方式**
   - 現金或刷卡

6. **完成儲值**
   - 點擊「確認儲值」
   - 系統自動生成收據編號
   - 儲值成功後更新客戶餘額

---

## 常見情境

### 情境 1：標準儲值（10%贈送）
```
儲值金額：NT$ 20,000
贈送紅利：10%（NT$ 2,000）
總儲值額：NT$ 22,000
```

### 情境 2：大額儲值（15%贈送）
```
儲值金額：NT$ 50,000
贈送紅利：15%（NT$ 7,500）
總儲值額：NT$ 57,500
```

### 情境 3：小額儲值（無贈送）
```
儲值金額：NT$ 3,000
贈送紅利：無贈送（NT$ 0）
總儲值額：NT$ 3,000
```

### 情境 4：自訂金額和贈送
```
儲值金額：NT$ 18,000
贈送紅利：NT$ 2,500（約13.9%）
總儲值額：NT$ 20,500
```

---

## 注意事項

1. **最低儲值金額**
   - 最低為 NT$ 1,000
   - 系統會自動限制不能低於此金額

2. **贈送金額**
   - 可以設定為 0（無贈送）
   - 沒有上限，完全由管理員決定

3. **收據編號**
   - 每筆儲值自動生成唯一編號
   - 格式：`DEP + 8位時間戳`
   - 用於比對實體儲值卡

4. **儲值記錄**
   - 所有儲值記錄永久保存
   - 可在客戶明細中查看
   - 包含實付、贈送、總額詳細信息

---

## 未來擴展

### 計畫功能
- [ ] 儲值活動快速套用（如：滿萬送千）
- [ ] 儲值歷史趨勢圖表
- [ ] 客戶儲值偏好分析
- [ ] 批量儲值功能
- [ ] 儲值優惠券系統

---

## 部署信息

- **更新日期**: 2025年1月
- **版本**: v2.1
- **部署狀態**: ✅ 已完成
- **部署URL**: https://spa-admin-firebase.web.app

---

## 相關文檔

- [會員制度說明](./MEMBERSHIP_SYSTEM.md)
- [會員制度更新摘要](./MEMBERSHIP_UPDATE_SUMMARY.md)
- [功能說明](./FEATURES.md)
- [README](./README.md)

---

**更新完成！** 🎉

新的儲值介面更靈活、更直觀，提供更好的使用體驗。
